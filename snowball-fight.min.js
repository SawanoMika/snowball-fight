/*! snowball-fight - v1.0.5 - 2015-03-05 */
Enemy.prototype.getAIFunc=function(e){var t=[function(e){var t=0;if(e.isFrozen){t=e.ACTION_TYPE_STOP}else{var i=Math.random();if(i<.1){t=e.ACTION_TYPE_STOP}else if(i<.6){t=e.ACTION_TYPE_ATTACK}else{t=e.ACTION_TYPE_MOVE}}switch(t){case e.ACTION_TYPE_STOP:e.timer=setTimeout(function(){e.isDoingAction=false}.bind(e),Math.floor(Math.random()*2e3)+200);break;case e.ACTION_TYPE_ATTACK:e.timer=setTimeout(function(){e.startForce();setTimeout(function(){e.endForce(Math.random()*50+40)}.bind(e),Math.floor(Math.random()*2e3)+400)}.bind(e),Math.floor(Math.random()*400)+200);break;case e.ACTION_TYPE_MOVE:var s=Math.floor(Math.random()*10+10);var a=Math.random()*2*Math.PI;var o=e.positionX+e.width/2+s*Math.cos(a);var n=e.positionY+e.height+s*Math.sin(a);var l=0;while(o<e.width/2||n<e.height||n>-.75*o+SCREEN_HEIGHT-80){s=Math.floor(Math.random()*10+10);a=Math.random()*2*Math.PI;o=e.positionX+e.width/2+s*Math.cos(a);n=e.positionY+e.height+s*Math.sin(a);l++;if(l>10){o=n=80;break}}Character.prototype.moveTo.call(e,new Point(o,n));break}},function(e){var t=0;if(e.isFrozen){t=e.ACTION_TYPE_STOP}else{var i=Math.random();if(i<.1){t=e.ACTION_TYPE_STOP}else if(i<.6){t=e.ACTION_TYPE_ATTACK}else{t=e.ACTION_TYPE_MOVE}}switch(t){case e.ACTION_TYPE_STOP:e.timer=setTimeout(function(){e.isDoingAction=false}.bind(e),Math.floor(Math.random()*2e3)+500);break;case e.ACTION_TYPE_ATTACK:e.timer=setTimeout(function(){e.startForce();setTimeout(function(){e.endForce(Math.floor(Math.random()*60)+40)}.bind(e),Math.floor(Math.random()*2e3)+400)}.bind(e),Math.floor(Math.random()*400+200));break;case e.ACTION_TYPE_MOVE:var s=Math.floor(game.player.positionX+game.player.width/2);var a=Math.floor(game.player.positionY+game.player.height);var o=Math.floor(e.positionX+e.width/2);var n=Math.floor(e.positionY+e.height);var l=Math.floor(Math.random()*50-20);var h=0;var r=Math.floor((4*(n-a)+3*(s+o))/6+l*.8-h*.8);var p=Math.floor((4*(a+n)+3*(o-s))/8+l*.6+h*.8);if(r>0&&p<e.height){p=Math.floor(e.height+1)}if(r<e.width/2&&p>0){r=Math.floor(e.width/2+1)}if(p>-.75*r+SCREEN_HEIGHT-80){r=o;p=n}e.moveTo.call(e,new Point(r,p));break}}];return t[e]};var ua=navigator.userAgent.toLowerCase();var info={ie:/msie/.test(ua)&&!/opera/.test(ua),op:/opera/.test(ua),sa:/version.*safari/.test(ua),ch:/chrome/.test(ua),ff:/gecko/.test(ua)&&!/webkit/.test(ua)};if(!Modernizr.canvas){window.location="unsupport.html"}else if(info.ie){window.location="unsupport.html"}function Item(e){Sprite.call(this,e);this.ITEM_INVISIBLE=0;this.ITEM_FIRE=1;this.ITEM_FROZEN=2;this.ITEM_POISON=3;this.ITEM_HP_POTION=4;this.ITEM_ATTACK_UP=5;this.ITEM_MOVE_SPEED_UP=6;this.ITEM_SNOWBALL_SPEED_UP=7;this.ITEM_TYPE_LIST=["Invisible","Fire","Frozen","Poison","HpPotion","AttackUp","MoveSpeedUp","SnowballSpeedUp"];this.ITEM_DRAW_TEXT_LIST=["隐身","火球攻击","冰球攻击","毒球攻击","HP+","攻击力上升","移动速度上升","雪球速度上升"];this.ITEM_SCORE=[200,300,300,300,0,200,200,200];this.HP_RESTORE_COUNT=200;this.itemType=this.getItemType();this.fallingWidth=24;this.fallingHeight=24;this.width=24;this.height=24;var t=46;this.positionX=Math.floor(Math.random()*(SCREEN_WIDTH-this.width));this.positionY=Math.floor(Math.random()*SCREEN_HEIGHT)-SCREEN_HEIGHT+t;while(this.positionY>SCREEN_HEIGHT-this.height*4||this.positionY<-.75*this.positionX+t){this.positionX=Math.floor(Math.random()*(SCREEN_WIDTH-this.width));this.positionY=Math.floor(Math.random()*SCREEN_HEIGHT)-SCREEN_HEIGHT+t}this.drawLayer=3;this.tickCount=0;this.FALL_TOTAL_COUNT=29;this.VANISH_TOTAL_COUNT=450;this.FALL_DY=3;this.isFalling=true;this.isVanishing=false;this.vanishFactor=1}Item.prototype=new Sprite;Item.prototype.draw=function(){if(this.isFalling){mainCanvas.drawImage(this.img,27,56,this.fallingWidth,this.fallingHeight,this.positionX,this.positionY,this.fallingWidth,this.fallingHeight)}else{mainCanvas.globalAlpha=this.vanishFactor;mainCanvas.drawImage(this.img,27,56,this.width,this.height,this.positionX,this.positionY,this.width,this.height);mainCanvas.globalAlpha=1}};Item.prototype.update=function(){if(this.isFalling){this.positionY+=this.FALL_DY;this.FALL_DY++;if(this.tickCount>this.FALL_TOTAL_COUNT){this.isFalling=false;this.tickCount=0}}else if(this.isVanishing){this.vanishFactor-=.1;if(this.vanishFactor<=0){this.isToDisposed=true}}else{if(this.checkCollision(game.player)){this.gainEffect();this.isVanishing=true}if(this.tickCount>this.VANISH_TOTAL_COUNT){this.isVanishing=true}}this.tickCount++};Item.prototype.gainEffect=function(){var e=game.player;var t=1e4;var i=5e3;var s="";switch(this.itemType){case this.ITEM_INVISIBLE:e.setInvisible();break;case this.ITEM_FIRE:e.setAttackType(e.ATTACK_TYPE_FIRE);break;case this.ITEM_FROZEN:e.setAttackType(e.ATTACK_TYPE_FROZEN);break;case this.ITEM_POISON:e.setAttackType(e.ATTACK_TYPE_POISON);break;case this.ITEM_HP_POTION:e.hp+=this.HP_RESTORE_COUNT;if(e.hp>e.MAX_HP){e.hp=e.MAX_HP}s+=this.HP_RESTORE_COUNT;break;case this.ITEM_ATTACK_UP:e.attackLevel=e.attackLevel<e.MAX_LEVEL?e.attackLevel+1:e.MAX_LEVEL;break;case this.ITEM_MOVE_SPEED_UP:e.moveSpeedLevel=e.moveSpeedLevel<e.MAX_LEVEL?e.moveSpeedLevel+1:e.MAX_LEVEL;break;case this.ITEM_SNOWBALL_SPEED_UP:e.snowballSpeedLevel=e.snowballSpeedLevel<e.MAX_LEVEL?e.snowballSpeedLevel+1:e.MAX_LEVEL;break}game.spriteGroup.add(new ItemText(this.ITEM_DRAW_TEXT_LIST[this.itemType]+s));game.gameScore+=this.ITEM_SCORE[this.itemType];game.LogList.push(new Log(EVENT_GET_ITEM,{stage:game.stageNum,item:this.ITEM_TYPE_LIST[this.itemType]}))};Item.prototype.checkCollision=function(e){var t=this.positionX;var i=this.positionY;var s=this.positionX+this.width;var a=this.positionY+this.height;var o=e.positionX+10;var n=e.positionY+e.height/3*2;var l=e.positionX+e.width-10;var h=e.positionY+e.height;return Math.abs(l+o-s-t)<=s-t+l-o&&Math.abs(h+n-a-i)<=a-i+h-n};Item.prototype.getItemType=function(){var e=Math.floor(Math.random()*this.ITEM_TYPE_LIST.length);var t=Math.random();if(game.stageNum<=5){e=Math.floor(Math.random()*this.ITEM_TYPE_LIST.length)}else if(game.stageNum<12){}else{}return e};function ItemText(e){Sprite.call(this);this.width=40;this.height=20;this.text=e;this.alpha=0;this.isUpMoving=true;this.isVanishing=false;this.waitCount=0;this.WAIT_TOTAL_COUNT=30}ItemText.prototype=new Sprite;ItemText.prototype.draw=function(){mainCanvas.save();mainCanvas.fillStyle="#0000FF";mainCanvas.font="20px 幼圆";mainCanvas.globalAlpha=this.alpha;mainCanvas.fillText(this.text,game.player.positionX-this.text.length*3,game.player.positionY-20);mainCanvas.restore()};ItemText.prototype.update=function(){if(this.isVanishing){this.alpha-=.1;if(this.alpha<=0)this.isToDisposed=true}if(this.isUpMoving){this.alpha+=.1;if(this.alpha>=1)this.isUpMoving=false}else if(this.waitCount<this.WAIT_TOTAL_COUNT)this.waitCount++;else this.isVanishing=true};function Logger(e,t){this.logList=[]}Logger.prototype.addLog=function(e,t){this.logList.push(e);t(this.logList)};Logger.prototype.reportLog=function(){};var getCalcScore=function(){var e=0;var t=1;var i=2;var s=3;var a=["KillingSpree","Dominating","MegaKill","Unstoppable","WickedSick","MonsterKill","GodLike","HolyShit","DoubleKill","TripleKill","UltraKill","Rampage"];var o=[200,300,450,650,900,1200,1600,2e3,500,750,1e3,1250];var n=["Invisible","Fire","Frozen","Poison","HpPotion","AttackUp","MoveSpeedUp","SnowballSpeedUp"];var l=[200,300,300,300,0,200,200,200];var h=50;var r=200;function p(s){var p=0;for(var v in s){var d=s[v];var S=d.info;switch(d.event){case e:p+=S.stage*h+r;break;case t:p+=o[a.indexOf(S.type)];break;case i:p+=l[n.indexOf(S.item)];break}}return p}return p};var EVENT_ENEMY_DIE=0;var EVENT_ACHIEVEMENT=1;var EVENT_GET_ITEM=2;var EVENT_PLAYER_DIE=3;function Log(e,t){this.time=(new Date).getTime();this.event=e;this.info=t}var SCREEN_WIDTH=800;var SCREEN_HEIGHT=600;var CANVAS_OFFSET_X;var CANVAS_OFFSET_Y;var REFRESH_INTERVAL=32;var CHARACTER_ID=0;var STARTSCREEN_IMAGE_PATH="image/startScreen.png";var BACKGROUND_IMAGE_PATH=["image/background1.png","image/background2.png","image/background3.png"];var ROLES_IMAGE_PATH="image/roles.png";var EXPLOSION_IMAGE_PATH="image/explosion.png";var WIDGET_IMAGE_PATH="image/widget.png";var TEXT_IMAGE_PATH="image/text.png";var GAMEOVER_IMAGE_PATH=["image/gameover1.png","image/gameover2.png","image/gameover3.png"];var LOADING_IMAGE_PATH="image/loading.png";var SNOW_IMAGE_PATH="image/snow.png";var MANUAL_IMAGE_PATH="image/manual.png";var ABOUT_IMAGE_PATH="image/about.png";var FONT_FILL_STYLE=["#FFCC00","#66FFCC","#FF99FF"];var SOUND_RESOURCE_NAME=["sound/bgm.mp3","sound/seCharge.mp3","sound/seExplosion.mp3","sound/seFrozen.mp3","sound/seHit.mp3","sound/seHitDead.mp3","sound/seMove.mp3","sound/sePause.mp3","sound/seSnowballFly.mp3","sound/seThrow.mp3","sound/achievement/seKillingSpree.mp3","sound/achievement/seDominating.mp3","sound/achievement/seMegaKill.mp3","sound/achievement/seUnstoppable.mp3","sound/achievement/seWickedSick.mp3","sound/achievement/seMonsterKill.mp3","sound/achievement/seGodLike.mp3","sound/achievement/seHolyShit.mp3","sound/achievement/seDoubleKill.mp3","sound/achievement/seTripleKill.mp3","sound/achievement/seUltraKill.mp3","sound/achievement/seRampage.mp3"];var SOUND_RESOURCE=new Array;var SOUND_RESOURCE_URL=new Array;SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[0]]="http://storage.live.com/items/314044073BEC6D79!4263";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[1]]="http://storage.live.com/items/314044073BEC6D79!4264";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[2]]="http://storage.live.com/items/314044073BEC6D79!4265";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[3]]="http://storage.live.com/items/314044073BEC6D79!4266";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[4]]="http://storage.live.com/items/314044073BEC6D79!4267";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[5]]="http://storage.live.com/items/314044073BEC6D79!4268";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[6]]="http://storage.live.com/items/314044073BEC6D79!4269";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[7]]="http://storage.live.com/items/314044073BEC6D79!4270";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[8]]="http://storage.live.com/items/314044073BEC6D79!4271";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[9]]="http://storage.live.com/items/314044073BEC6D79!4272";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[10]]="http://storage.live.com/items/314044073BEC6D79!4273";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[11]]="http://storage.live.com/items/314044073BEC6D79!4274";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[12]]="http://storage.live.com/items/314044073BEC6D79!4275";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[13]]="http://storage.live.com/items/314044073BEC6D79!4276";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[14]]="http://storage.live.com/items/314044073BEC6D79!4277";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[15]]="http://storage.live.com/items/314044073BEC6D79!4278";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[16]]="http://storage.live.com/items/314044073BEC6D79!4279";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[17]]="http://storage.live.com/items/314044073BEC6D79!4280";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[18]]="http://storage.live.com/items/314044073BEC6D79!4281";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[19]]="http://storage.live.com/items/314044073BEC6D79!4282";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[20]]="http://storage.live.com/items/314044073BEC6D79!4283";SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[21]]="http://storage.live.com/items/314044073BEC6D79!4284";var IMAGE_RESOURCE_NAME=["image/background1.png","image/background2.png","image/background3.png","image/explosion.png","image/gameover1.png","image/gameover2.png","image/gameover3.png","image/loading.png","image/roles.png","image/startScreen.png","image/text.png","image/widget.png","image/snow.png","image/manual.png","image/about.png"];var IMAGE_RESOURCE=new Array;var IMAGE_RESOURCE_URL=new Array;IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[0]]="http://storage.live.com/items/314044073BEC6D79!1025";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[1]]="http://storage.live.com/items/314044073BEC6D79!1026";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[2]]="http://storage.live.com/items/314044073BEC6D79!1027";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[3]]="http://storage.live.com/items/314044073BEC6D79!1028";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[4]]="http://storage.live.com/items/314044073BEC6D79!1029";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[5]]="http://storage.live.com/items/314044073BEC6D79!1030";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[6]]="http://storage.live.com/items/314044073BEC6D79!1031";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[7]]="http://storage.live.com/items/314044073BEC6D79!1032";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[8]]="http://storage.live.com/items/314044073BEC6D79!1033";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[9]]="http://storage.live.com/items/314044073BEC6D79!1034";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[10]]="http://storage.live.com/items/314044073BEC6D79!1035";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[11]]="http://storage.live.com/items/314044073BEC6D79!1036";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[12]]="http://storage.live.com/items/314044073BEC6D79!1810";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[13]]="http://storage.live.com/items/314044073BEC6D79!2173";IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[14]]="http://storage.live.com/items/314044073BEC6D79!2254";var mainCanvas;var screenManager;var loadingScreen;var storyScreen;var startScreen;var game;function LoadingScreen(){GameComponent.call(this);this.loadingImage=new Image;this.loadingImage.src=LOADING_IMAGE_PATH;this.showText="";this.hintTextList=["火球攻击可以产生范围伤害","冰球攻击可以让敌人动弹不得","毒球攻击可以让敌人在一段时间内不断掉血","短时间内击杀更多敌人可以获得成就加分","无伤情况下击杀敌人可以获得成就加分","攻击力、移动速度、雪球速度的提升是永久性的","每过一关都会恢复少许血量"];this.hintTextIndex=Math.floor(Math.random()*this.hintTextList.length);this.loadedCompleteCount=0;this.loadedTotalCount=SOUND_RESOURCE_NAME.length+IMAGE_RESOURCE_NAME.length;this.resourceList=new Array}LoadingScreen.prototype=new GameComponent;LoadingScreen.prototype.initialize=function(){this.loadResource()};LoadingScreen.prototype.draw=function(){mainCanvas.save();mainCanvas.fillStyle="#000000";mainCanvas.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT+40);mainCanvas.fillStyle="#FFFF00";mainCanvas.font="64px Impact";mainCanvas.fillText(this.showText,160,120);mainCanvas.font="24px 幼圆";mainCanvas.fillText(this.hintTextList[this.hintTextIndex],SCREEN_WIDTH/2-this.hintTextList[this.hintTextIndex].length/2*24,600);mainCanvas.restore();mainCanvas.drawImage(this.loadingImage,180,160)};LoadingScreen.prototype.update=function(){if(this.loadedCompleteCount>=this.loadedTotalCount){startScreen=new StartScreen;screenManager.setComponent(startScreen)}else{this.showText="NOW LOADING   "+Math.floor(this.loadedCompleteCount/this.loadedTotalCount*100)+"%"}};LoadingScreen.prototype.loadResource=function(){for(var e=0;e<SOUND_RESOURCE_NAME.length;e++){var t=new Audio;t.src=SOUND_RESOURCE_URL[SOUND_RESOURCE_NAME[e]];if(SOUND_RESOURCE_NAME[e]=="sound/bgm.mp3")t.loop=true;SOUND_RESOURCE[SOUND_RESOURCE_NAME[e]]=t;t.addEventListener("canplaythrough",function(){loadingScreen.loadedCompleteCount++});this.resourceList.push(t)}for(var i=0;i<IMAGE_RESOURCE_NAME.length;i++){var s=new Image;s.src=IMAGE_RESOURCE_URL[IMAGE_RESOURCE_NAME[i]];s.addEventListener("load",function(){loadingScreen.loadedCompleteCount++},false);IMAGE_RESOURCE[IMAGE_RESOURCE_NAME[i]]=s;this.resourceList.push(s)}};function StartScreen(){GameComponent.call(this);this.index=0;this.background=new Background(IMAGE_RESOURCE[STARTSCREEN_IMAGE_PATH],true);this.aboutImage=IMAGE_RESOURCE[ABOUT_IMAGE_PATH];this.showAbout=false}StartScreen.prototype=new GameComponent;StartScreen.prototype.update=function(){};StartScreen.prototype.draw=function(){mainCanvas.clearRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT+40);this.background.draw();if(this.showAbout){mainCanvas.drawImage(this.aboutImage,85,61)}};StartScreen.prototype.initialize=function(){$(window).click(startScreen.mouseClickEvent)};StartScreen.prototype.mouseClickEvent=function(e){var t=288,i=417,s=224,a=76;var o=288,n=513,l=224,h=76;var r=e.pageX-CANVAS_OFFSET_X;var p=e.pageY-CANVAS_OFFSET_Y;if(r>t&&r<t+s&&p>i&&p<i+a){$(window).unbind();storyScreen=new StoryScreen;screenManager.setComponent(storyScreen)}else if(r>o&&r<o+l&&p>n&&p<n+h){startScreen.showAbout=true}else if(startScreen.showAbout){startScreen.showAbout=false}};function StoryScreen(){GameComponent.call(this);this.text="";this.state=0;this.textImage=IMAGE_RESOURCE["image/text.png"];this.manual=IMAGE_RESOURCE["image/manual.png"];this.positionY=640}StoryScreen.prototype=new GameComponent;StoryScreen.prototype.initialize=function(){$(window).click(storyScreen.mouseClickEvent)};StoryScreen.prototype.draw=function(){if(this.state==0){mainCanvas.clearRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT+40);mainCanvas.drawImage(this.textImage,201,77,633,373,80,this.positionY,633,373)}else if(this.state==1){mainCanvas.clearRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT+40);mainCanvas.drawImage(this.manual,0,0)}mainCanvas.save();mainCanvas.font="32px Impact";mainCanvas.fillStyle="#00FF00";mainCanvas.fillText("CLICK TO SKIP",30,50);mainCanvas.restore()};StoryScreen.prototype.update=function(){if(this.state==0&&this.positionY>114){this.positionY-=2}};StoryScreen.prototype.mouseClickEvent=function(e){if(storyScreen.state==0)storyScreen.state=1;else{$(window).unbind();game=new SnowballFightGame;screenManager.setComponent(game)}};function SnowballFightGame(){GameComponent.call(this);this.BASE_ENEMY_SCORE=200;this.ENEMY_STEP_SCORE=50;this.isGameOver=false;this.isPause=false;this.gameScore=0;this.stageNum=0;this.stageClass=0;this.stageState="LOAD_STAGE";this.isMouseOnPlayer=false;this.isMouseDown=false;this.showRetryHint=false;this.showSubmitHint=false;this.hasSubmitScore=false;this.ITEM_RANDOM_TIME_MIN_LIST=[240,180,120];this.ITEM_RANDOM_TIME_MAX_LIST=[450,360,240];this.ITEM_RANDOM_TIME_MIN=this.ITEM_RANDOM_TIME_MIN_LIST[0];this.ITEM_RANDOM_TIME_MAX=this.ITEM_RANDOM_TIME_MAX_LIST[0];this.ITEM_BASENUMBER_LIST=[5,8,12];this.itemNumber=this.ITEM_BASENUMBER_LIST[0];this.itemTickCount=0;this.playerInfoText="";this.LogList=[];this.bgm=new AudioSprite(SOUND_RESOURCE["sound/bgm.mp3"],true);this.seCharge=new AudioSprite(SOUND_RESOURCE["sound/seCharge.mp3"],false);this.seExplosion=new AudioSprite(SOUND_RESOURCE["sound/seExplosion.mp3"],false);this.seFrozen=new AudioSprite(SOUND_RESOURCE["sound/seFrozen.mp3"],false);this.seHit=new AudioSprite(SOUND_RESOURCE["sound/seHit.mp3"],false);this.seHitDead=new AudioSprite(SOUND_RESOURCE["sound/seHitDead.mp3"],false);this.sePause=new AudioSprite(SOUND_RESOURCE["sound/sePause.mp3"],false);this.seMove=new AudioSprite(SOUND_RESOURCE["sound/seMove.mp3"],true);this.seSnowballFly=new AudioSprite(SOUND_RESOURCE["sound/seSnowballFly.mp3"],false);this.seThrow=new AudioSprite(SOUND_RESOURCE["sound/seThrow.mp3"],false);this.seKillingSpree=new AudioSprite(SOUND_RESOURCE["sound/achievement/seKillingSpree.mp3"],false);this.seDominating=new AudioSprite(SOUND_RESOURCE["sound/achievement/seDominating.mp3"],false);this.seMegaKill=new AudioSprite(SOUND_RESOURCE["sound/achievement/seMegaKill.mp3"],false);this.seUnstoppable=new AudioSprite(SOUND_RESOURCE["sound/achievement/seUnstoppable.mp3"],false);this.seWickedSick=new AudioSprite(SOUND_RESOURCE["sound/achievement/seWickedSick.mp3"],false);this.seMonsterKill=new AudioSprite(SOUND_RESOURCE["sound/achievement/seMonsterKill.mp3"],false);this.seGodLike=new AudioSprite(SOUND_RESOURCE["sound/achievement/seGodLike.mp3"],false);this.seHolyShit=new AudioSprite(SOUND_RESOURCE["sound/achievement/seHolyShit.mp3"],false);this.seDoubleKill=new AudioSprite(SOUND_RESOURCE["sound/achievement/seDoubleKill.mp3"],false);this.seTripleKill=new AudioSprite(SOUND_RESOURCE["sound/achievement/seTripleKill.mp3"],false);this.seUltraKill=new AudioSprite(SOUND_RESOURCE["sound/achievement/seUltraKill.mp3"],false);this.seRampage=new AudioSprite(SOUND_RESOURCE["sound/achievement/seRampage.mp3"],false);this.spriteGroup=new SpriteGroup}SnowballFightGame.prototype=new GameComponent;SnowballFightGame.prototype.initialize=function(){$(window).mousedown(game.mouseDownEvent);$(window).mousemove(game.mouseMoveEvent);$(window).mouseup(game.mouseUpEvent);$(window).click(game.mouseClickEvent);$(document).bind("contextmenu",function(e){return false});this.moveMarker=new MoveMarker(IMAGE_RESOURCE[WIDGET_IMAGE_PATH]);this.selectedRing=new SelectedRing(IMAGE_RESOURCE[WIDGET_IMAGE_PATH]);this.energyTrough=new EnergyTrough(IMAGE_RESOURCE[WIDGET_IMAGE_PATH]);this.itemGroup=new RoleGroup("Item");this.hpTroughGroup=new RoleGroup("HpTrough");this.player=new Player(IMAGE_RESOURCE[ROLES_IMAGE_PATH],{startPosition:new Point(600,413)},this.hpTroughGroup);this.enemyGroup=new RoleGroup("Enemy");this.spriteGroup.add(this.selectedRing);this.spriteGroup.add(this.moveMarker);this.spriteGroup.add(this.energyTrough);this.spriteGroup.add(this.player);this.spriteGroup.add(this.hpTroughGroup);this.spriteGroup.add(this.enemyGroup);this.spriteGroup.add(this.itemGroup);this.loadNewStage();this.bgm.play()};SnowballFightGame.prototype.draw=function(){mainCanvas.clearRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT);this.spriteGroup.draw();mainCanvas.save();mainCanvas.font="20px Impact";mainCanvas.fillStyle=FONT_FILL_STYLE[this.stageClass];mainCanvas.fillText(this.playerInfoText,10,SCREEN_HEIGHT+28);mainCanvas.restore();if(this.showRetryHint||this.showSubmitHint){mainCanvas.strokeRect(this.hintPosition.x-140,this.hintPosition.y-80,290,this.showRetryHint?46:72);mainCanvas.save();mainCanvas.fillStyle="#3399FF";mainCanvas.fillRect(this.hintPosition.x-140,this.hintPosition.y-80,290,this.showRetryHint?46:72);mainCanvas.restore();mainCanvas.font="16px 幼圆";if(this.showRetryHint){mainCanvas.fillText("再玩一次挑战更高难度的关卡吧！",this.hintPosition.x-140+24,this.hintPosition.y-80+30)}else{mainCanvas.fillText("提交你的分数。",this.hintPosition.x-140+8,this.hintPosition.y-80+24);mainCanvas.fillText("截止至2013年1月1日晚上0点，TOP5",this.hintPosition.x-140+8,this.hintPosition.y-80+44);mainCanvas.fillText("将可以获得我们团队送出的特制礼物哦",this.hintPosition.x-140+8,this.hintPosition.y-80+64)}}};SnowballFightGame.prototype.update=function(){if(!this.isPause){switch(this.stageState){case"LOAD_STAGE":this.loadNewStage();break;case"STAGE_TEXT":break;case"LOAD_ROLES":this.loadRoles();break;case"GAME_PLAYING":this.isGameOver=this.player.isDead;if(!this.isGameOver){this.updateMainGame();this.updatePlayerInfo()}else{this.gameOver()}break;case"STAGE_CLEAR":break;case"GAME_OVER":break;default:break}this.spriteGroup.update()}};SnowballFightGame.prototype.loadNewStage=function(){this.stageInfo=StageInfo[++this.stageNum-1];this.spriteGroup.remove(this.stageText);this.stageText=new StageText(IMAGE_RESOURCE[TEXT_IMAGE_PATH],this.stageNum);this.spriteGroup.add(this.stageText);if(this.stageNum<=5){this.stageClass=0}else if(this.stageNum<=12){this.stageClass=1}else{this.stageClass=2}this.spriteGroup.remove(this.background);this.spriteGroup.remove(this.stateBoard);this.spriteGroup.remove(this.fallingSnow);this.background=new Background(IMAGE_RESOURCE[BACKGROUND_IMAGE_PATH[this.stageClass]],false);this.stateBoard=new StateBoard(IMAGE_RESOURCE[BACKGROUND_IMAGE_PATH[this.stageClass]]);this.spriteGroup.add(this.background);this.spriteGroup.add(this.stateBoard);if(this.stageNum>=3&&this.stageNum<=5||this.stageNum>=9&&this.stageNum<=12||this.stageNum>=16){this.fallingSnow=new FallingSnow(IMAGE_RESOURCE[SNOW_IMAGE_PATH]);this.spriteGroup.add(this.fallingSnow)}this.ITEM_RANDOM_TIME_MIN=this.ITEM_RANDOM_TIME_MIN_LIST[this.stageClass];this.ITEM_RANDOM_TIME_MAX=this.ITEM_RANDOM_TIME_MAX_LIST[this.stageClass];this.itemNumber=this.ITEM_BASENUMBER_LIST[this.stageClass]+Math.floor(Math.random()*this.ITEM_BASENUMBER_LIST[this.stageClass]);this.itemTickCount=Math.floor(Math.random()*(this.ITEM_RANDOM_TIME_MAX-this.ITEM_RANDOM_TIME_MIN)+this.ITEM_RANDOM_TIME_MIN);this.enemyGroup.clear();this.stageState="STAGE_TEXT"};SnowballFightGame.prototype.loadRoles=function(){for(var e in this.stageInfo){this.enemyGroup.add(new Enemy(IMAGE_RESOURCE[ROLES_IMAGE_PATH],this.stageInfo[e],this.hpTroughGroup))}this.stageState="GAME_PLAYING"};SnowballFightGame.prototype.updateMainGame=function(){var e=true;for(var t in this.enemyGroup.group){e=e&&this.enemyGroup.group[t].isDead}if(!this.isGameOver&&e){var i=[.15,.12,.1];this.player.hp+=Math.floor(this.player.MAX_HP*i[this.stageClass]);if(this.player.hp>this.player.MAX_HP)this.player.hp=this.player.MAX_HP;this.stageText.triggleClear();this.stageState="STAGE_CLEAR";this.itemGroup.clear();return}if(this.itemTickCount==0&&this.itemNumber>0){this.itemTickCount=Math.floor(Math.random()*(this.ITEM_RANDOM_TIME_MAX-this.ITEM_RANDOM_TIME_MIN)+this.ITEM_RANDOM_TIME_MIN);this.itemGroup.add(new Item(IMAGE_RESOURCE[WIDGET_IMAGE_PATH]));this.itemNumber--}else{this.itemTickCount--}this.spriteGroup.flush()};SnowballFightGame.prototype.updatePlayerInfo=function(){var e="普通";switch(this.player.attackType){case this.player.ATTACK_TYPE_NORMAL:default:e="普通";break;case this.player.ATTACK_TYPE_FIRE:e="火焰";break;case this.player.ATTACK_TYPE_FROZEN:e="冰冻";break;case this.player.ATTACK_TYPE_POISON:e="剧毒";break}this.playerInfoText="攻击力LV:"+(this.player.attackLevel==this.player.MAX_LEVEL?"MAX":this.player.attackLevel)+"  移动速度LV:"+(this.player.moveSpeedLevel==this.player.MAX_LEVEL?"MAX":this.player.moveSpeedLevel)+"  雪球速度LV:"+(this.player.snowballSpeedLevel==this.player.MAX_LEVEL?"MAX":this.player.snowballSpeedLevel)+"  攻击类型:"+e+"  关卡:"+this.stageNum+"  分数:"+this.gameScore};SnowballFightGame.prototype.gameOver=function(){var e=function(e){var t=e.pageX-CANVAS_OFFSET_X;var i=e.pageY-CANVAS_OFFSET_Y;game.showRetryHint=game.retryButton.isVisible=game.retryButton.isMouseOn=t>game.retryButton.positionX&&t<game.retryButton.positionX+game.retryButton.width&&i>game.retryButton.positionY&&i<game.retryButton.positionY+game.retryButton.height;game.showSubmitHint=game.submitButton.isVisible=game.submitButton.isMouseOn=!game.hasSubmitScore&&t>game.submitButton.positionX&&t<game.submitButton.positionX+game.submitButton.width&&i>game.submitButton.positionY&&i<game.submitButton.positionY+game.submitButton.height;if(game.showRetryHint||game.showSubmitHint){game.hintPosition=new Point(t,i)}};var t=function(e){if(game.retryButton.isMouseOn){game.restart()}else if(game.submitButton.isMouseOn){$("#submitBox").show()}};var i=function(){$(window).unbind();$(window).mousemove(e);$(window).click(t)};this.spriteGroup.add(new GameoverGround(IMAGE_RESOURCE[GAMEOVER_IMAGE_PATH[this.stageClass]]));this.retryButton=new GameoverGroundButton(IMAGE_RESOURCE[GAMEOVER_IMAGE_PATH[this.stageClass]],0);this.submitButton=new GameoverGroundButton(IMAGE_RESOURCE[GAMEOVER_IMAGE_PATH[this.stageClass]],1);this.spriteGroup.add(this.retryButton);this.spriteGroup.add(this.submitButton);this.spriteGroup.add(new GameoverScoreBoard(IMAGE_RESOURCE[GAMEOVER_IMAGE_PATH[this.stageClass]],this.stageClass,this.gameScore,i));this.hpTroughGroup.clear();this.stageState="GAME_OVER"};SnowballFightGame.prototype.restart=function(){this.bgm.stop();$(window).unbind();game=new SnowballFightGame;screenManager.setComponent(game)};SnowballFightGame.prototype.addScore=function(e,t){var i=["KillingSpree","Dominating","MegaKill","Unstoppable","WickedSick","MonsterKill","GodLike","HolyShit","DoubleKill","TripleKill","UltraKill","Rampage"];var s=[200,300,450,650,900,1200,1600,2e3,500,750,1e3,1250];switch(e){case"ENEMY":this.gameScore+=this.stageNum*this.ENEMY_STEP_SCORE+this.BASE_ENEMY_SCORE;break;case"ACHIEVEMENT":this.gameScore+=s[i.indexOf(t)];break}};SnowballFightGame.prototype.pause=function(){this.isPause=!this.isPause;if(this.isPause){this.bgm.pause();this.seMove.stop();this.sePause.play()}else{this.bgm.play()}};SnowballFightGame.prototype.mouseClickEvent=function(e){var t=function(e){var t=e.pageX-CANVAS_OFFSET_X;var i=e.pageY-CANVAS_OFFSET_Y;if(t>735&&t<735+24&&i>608&&i<608+24){}};var i=function(e){var t=e.pageX-CANVAS_OFFSET_X;var i=e.pageY-CANVAS_OFFSET_Y;var s=30;var a=t>game.player.width*2&&t<SCREEN_WIDTH-game.player.width/2&&i<SCREEN_HEIGHT&&i>-.75*t+SCREEN_HEIGHT+s;return a};t(e);if(game.stageState=="GAME_PLAYING"&&!game.isPause){if(!game.isMouseOnPlayer&&i(e)){var s=new Point(e.pageX-CANVAS_OFFSET_X,e.pageY-CANVAS_OFFSET_Y);game.moveMarker.setPosition(s);game.moveMarker.isVisible=true;game.player.moveTo(s)}}};SnowballFightGame.prototype.mouseDownEvent=function(e){if(game.stageState=="GAME_PLAYING"&&!game.isPause){if(game.isMouseOnPlayer&&!game.isMouseDown&&!this.isRigidity){game.player.startForce();game.isMouseDown=true;game.energyTrough.isIncreasing=true;game.moveMarker.isVisible=false;game.seCharge.play()}}};SnowballFightGame.prototype.mouseMoveEvent=function(e){var t=function(e,t){var i=e.pageX-CANVAS_OFFSET_X;var s=e.pageY-CANVAS_OFFSET_Y;var a=0;var o=t.positionX;var n=t.positionY;var l=t.width;var h=t.height;var r=i>o+a&&i<o+l-a&&s>n+10&&s<n+h-a;return r};if(game.stageState=="GAME_PLAYING"&&!game.isPause){game.isMouseOnPlayer=t(e,game.player);if(game.isMouseOnPlayer){game.selectedRing.setPosition(new Point(game.player.positionX,game.player.positionY));game.selectedRing.isVisible=true}else{game.selectedRing.isVisible=false}}};SnowballFightGame.prototype.mouseUpEvent=function(e){if(game.stageState=="GAME_PLAYING"&&game.player.isChargingForce&&!this.isRigidity){game.player.endForce();game.isMouseDown=false;game.energyTrough.isIncreasing=false;game.seCharge.stop()}};$(document).ready(documentReady);function documentReady(){$("#submitBox").hide();mainCanvas=$("#gameCanvas").get(0).getContext("2d");$("#gameCanvas").on("selectstart",function(){return false});var e=$("#gameCanvas").offset();CANVAS_OFFSET_X=e.left;CANVAS_OFFSET_Y=e.top;loadingScreen=new LoadingScreen;screenManager=new ScreenManager(loadingScreen);screenManager.start()}function Character(e){DynamicSprite.call(this,e);this.STATUS_STAND=0;this.STATUS_MOVE1=1;this.STATUS_MOVE2=2;this.STATUS_CHARGEFORCE=3;this.STATUS_THROW=4;this.STATUS_HIT=5;this.CHARACTER_TYPE_PLAYER=0;this.CHARACTER_TYPE_ENEMY=1;this.ATTACK_TYPE_NORMAL=0;this.ATTACK_TYPE_FIRE=1;this.ATTACK_TYPE_FROZEN=2;this.ATTACK_TYPE_POISON=3;this.width=40;this.height=80;this.positionX=0;this.positionY=0;this.moveDx=0;this.moveDy=0;this.drawLayer=5;this.tickCount=0;this.TOTAL_COUNT=0;this.id=CHARACTER_ID++;this.status=this.STATUS_STAND;this.characterType=this.CHARACTER_TYPE_PLAYER;this.shadowWidth=30;this.shadowHeight=12;this.shadowOffsetX=0;this.shadowOffsetY=66;this.isEnemy=true;this.isDead=false;this.isMoving=false;this.isChargingForce=false;this.chargeForce=0;this.MAX_FORCE=100;this.hp=1e3;this.MAX_HP=1e3;this.attackLevel=1;this.moveSpeedLevel=1;this.snowballSpeedLevel=1;this.MAX_LEVEL=5;this.ATTACK_FACTOR=100;this.INIT_ATTACK=200;this.MOVE_SPEED_FACTOR=1.5;this.MOVE_INIT_SPEED=4.5;this.SNOWBALL_SPEED_FACTOR=2;this.SNOWBALL_INIT_SPEED=6;this.isRigidity=false;this.rigidityCount=0;this.RIGIDITY_TOTAL_COUNT=45;this.attackType=this.ATTACK_TYPE_NORMAL;this.attackSpecialCount=0;this.ATTACK_SPECIAL_TOTAL_COUNT=360;this.isInvisible=false;this.invisibleCount=0;this.INVISIBLE_TOTAL_COUNT=300;this.isFrozen=false;this.frozenCount=0;this.FROZEN_TOTAL_COUNT=60;this.isPoisoning=false;this.poisoningCount=0;this.POISONING_TOTAL_COUNT=90;this.timer=null;this.hpTrough=new HpTrough(IMAGE_RESOURCE[WIDGET_IMAGE_PATH],this)}Character.prototype=new DynamicSprite;Character.prototype.draw=function(){if(!this.isDead){mainCanvas.drawImage(this.img,this.status*this.width,this.characterType*this.height,this.width,this.height,this.positionX,this.positionY,this.width,this.height);mainCanvas.drawImage(this.img,320,0,this.shadowWidth,this.shadowHeight,this.positionX+this.shadowOffsetX,this.positionY+this.shadowOffsetY,this.shadowWidth,this.shadowHeight)}};Character.prototype.update=function(){if(!game.isGameOver){this.hpTrough.setPosition(new Point(this.positionX,this.positionY));this.hpTrough.setWidthRate(this.hp/this.MAX_HP);if(!this.isRigidity){this.chargeForceUpdate();this.specialStatusUpdate();if(this.isMoving){this.moveUpdate()}}else if(this.rigidityCount<this.RIGIDITY_TOTAL_COUNT){this.rigidityCount++;this.status=this.STATUS_HIT}else{this.status=this.STATUS_STAND;
this.isRigidity=false;this.isDoingAction=false}}};Character.prototype.chargeForceUpdate=function(){if(this.isChargingForce&&this.chargeForce<=this.MAX_FORCE){this.chargeForce+=5}};Character.prototype.specialStatusUpdate=function(){if(this.isInvisible&&this.invisibleCount<this.INVISIBLE_TOTAL_COUNT){this.invisibleCount++}else{this.isInvisible=false}if(this.attackType!=this.ATTACK_TYPE_NORMAL&&this.attackSpecialCount<this.ATTACK_SPECIAL_TOTAL_COUNT){this.attackSpecialCount++}else{this.attackType=this.ATTACK_TYPE_NORMAL}if(this.isFrozen){if(this.frozenCount<this.FROZEN_TOTAL_COUNT){if(this.timer!=null){clearTimeout(this.timer)}this.frozenCount++}else{this.isDoingAction=false;this.isFrozen=false}}if(this.isPoisoning&&this.poisoningCount<this.POISONING_TOTAL_COUNT){this.hp-=Math.floor(this.MAX_HP*.005);if(this.hp<=1){this.hp=1;this.isPoisoning=false}this.poisoningCount++}else{this.isPoisoning=false}};Character.prototype.moveUpdate=function(){if(this.tickCount<this.TOTAL_COUNT){if(this.positionX+this.moveDx<=0||this.positionY+this.moveDy<=0){this.stopMove();return}this.positionX+=this.moveDx;this.positionY+=this.moveDy;if(this.tickCount%10==0){this.status=this.status==this.STATUS_MOVE1?this.STATUS_MOVE2:this.STATUS_MOVE1}if(this.RIGIDITY_TOTAL_COUNT<45){this.RIGIDITY_TOTAL_COUNT++}this.tickCount++}else{this.isMoving=false;this.isDoingAction=false;this.status=this.STATUS_STAND;game.moveMarker.isVisible=false;game.seMove.stop()}};Character.prototype.startForce=function(){this.stopMove();this.isChargingForce=true;this.isDoingAction=true;this.status=this.STATUS_CHARGEFORCE};Character.prototype.endForce=function(e){if(this.chargeForce>0){game.spriteGroup.add(new Snowball(IMAGE_RESOURCE[WIDGET_IMAGE_PATH],{positionX:this.positionX,positionY:this.positionY+(this.isEnemy?45:0),force:e||this.chargeForce,directionToEnemy:e==undefined?true:false,host:this}));this.status=this.STATUS_THROW;setTimeout(function(){this.status=this.STATUS_STAND}.bind(this),500);if(this.chargeForce>60){game.seSnowballFly.play()}else{game.seThrow.play()}this.isChargingForce=false;this.chargeForce=0;this.isDoingAction=false}};Character.prototype.moveTo=function(e){var t=this.positionX+this.width/2;var i=this.positionY+this.height;var s=(this.moveSpeedLevel-1)*this.MOVE_SPEED_FACTOR+this.MOVE_INIT_SPEED;var a=Math.sqrt((e.x-t)*(e.x-t)+(e.y-i)*(e.y-i));this.TOTAL_COUNT=Math.round(a/s);this.moveDx=(e.x-t)/this.TOTAL_COUNT;this.moveDy=(e.y-i)/this.TOTAL_COUNT;this.tickCount=0;this.isMoving=true;game.seMove.play()};Character.prototype.stopMove=function(){this.moveTo(new Point(this.positionX,this.positionY));this.status=this.STATUS_STAND;this.isDoingAction=false;this.isMoving=false;game.seMove.stop()};Character.prototype.beHit=function(e,t){this.hp-=e;if(this.hp<=0){this.die(t)}if(this.timer!=undefined&&this.timer!=null){clearTimeout(this.timer)}switch(t.attackType){case this.ATTACK_TYPE_FIRE:break;case this.ATTACK_TYPE_FROZEN:this.isFrozen=true;this.frozenCount=0;this.chargeForce=0;game.seFrozen.play();break;case this.ATTACK_TYPE_POISON:this.isPoisoning=true;this.poisoningCount=0;break;case this.ATTACK_TYPE_NORMAL:break}game.seHit.play();game.seCharge.stop();this.status=this.STATUS_HIT;if(this.RIGIDITY_TOTAL_COUNT>15){this.RIGIDITY_TOTAL_COUNT-=8}this.isRigidity=true;this.rigidityCount=0;this.isDoingAction=true};Character.prototype.setAttackType=function(e){this.attackType=e;this.attackSpecialCount=0};Character.prototype.setInvisible=function(){this.isInvisible=true;this.invisibleCount=0};Character.prototype.die=function(e){this.isDead=true;this.hpTrough.isToDisposed=true;this.drawLayer=2;this.chargeForce=0;if(this.timer!=null){clearTimeout(this.timer)}game.seHitDead.play();game.addScore("ENEMY");game.LogList.push(new Log(EVENT_ENEMY_DIE,{stage:game.stageNum,id:this.id}))};function Player(e,t,i){Character.call(this,e,t);this.characterType=this.CHARACTER_TYPE_PLAYER;this.attackType=this.ATTACK_TYPE_NORMAL;this.positionX=600;this.positionY=413;this.shadowOffsetX=-2;this.shadowOffsetY=70;this.hp=3e3;this.MAX_HP=3e3;this.INIT_ATTACK=200;this.isEnemy=false;this.ckNoDamageAchievement=[false,false,false,false,false,false,false,false];this.ckNoDamage=0;this.ckShortTimeAchievement=[false,false,false,false];this.ckShortTime=0;this.ckShortTimeCount=0;this.CK_SHORT_TIME_TOTAL_COUNT=210;i.add(this.hpTrough)}Player.prototype=new Character;Player.prototype.draw=function(){if(!this.isDead){if(this.isInvisible){mainCanvas.globalAlpha=.4}mainCanvas.drawImage(this.img,320,0,this.shadowWidth,this.shadowHeight,this.positionX+this.shadowOffsetX,this.positionY+this.shadowOffsetY,this.shadowWidth,this.shadowHeight);mainCanvas.drawImage(this.img,this.status*this.width,this.characterType*this.height,this.width,this.height,this.positionX,this.positionY,this.width,this.height);mainCanvas.globalAlpha=1}else{mainCanvas.drawImage(this.img,240,16,62,64,this.positionX+13,this.positionY+67,62,64)}};Player.prototype.update=function(){if(!this.isDead){Character.prototype.update.call(this);if(game.isMouseOnPlayer){game.selectedRing.setPosition(new Point(game.player.positionX,game.player.positionY))}if(this.ckShortTime>0){if(this.ckShortTimeCount<this.CK_SHORT_TIME_TOTAL_COUNT){this.ckShortTimeCount++}else{this.ckShortTime=0;this.ckShortTimeCount=0;this.ckShortTimeAchievement=[false,false,false,false]}}}};Player.prototype.die=function(){this.isDead=true;this.drawLayer=2;game.seHitDead.play();game.LogList.push(new Log(EVENT_PLAYER_DIE,{stage:game.stageNum,id:this.id}))};function Enemy(e,t,i){Character.call(this,e,t);this.ACTION_TYPE_STOP=0;this.ACTION_TYPE_ATTACK=1;this.ACTION_TYPE_MOVE=2;this.NO_DAMAGE_ACHIEVEMENT_LIST=["KillingSpree","Dominating","MegaKill","Unstoppable","WickedSick","MonsterKill","GodLike","HolyShit"];this.NO_DAMAGE_ACHIEVEMENT_CHN_LIST=["大杀特杀","主宰比赛","杀人如麻","无人能挡","变态杀戮","如同妖怪一般","如同神一般","超越神的存在"];this.SHORT_TIME_ACHIEVEMENT_LIST=["DoubleKill","TripleKill","UltraKill","Rampage"];this.SHORT_TIME_ACHIEVEMENT_CHN_LIST=["双杀","三杀","四杀","暴走"];this.aiLevel=t.aiLevel;this.attackLevel=t.attackLevel;this.moveSpeedLevel=t.moveSpeedLevel;this.snowballSpeedLevel=t.snowballSpeedLevel;this.hp=this.MAX_HP=t.MAX_HP;this.characterType=this.CHARACTER_TYPE_ENEMY;this.positionX=t.startPosition.x;this.positionY=t.startPosition.y;this.shadowOffsetX=4;this.shadowOffsetY=72;this.jumpDy=10;this.jumpCount=0;this.JUMP_TOTAL_COUNT=21;this.timer=null;this.isDoingAction=false;i.add(this.hpTrough)}Enemy.prototype=new Character;Enemy.prototype.draw=function(){if(!game.isGameOver){if(!this.isDead){if(this.isFrozen){mainCanvas.drawImage(this.img,321,80,64,76,this.positionX-15,this.positionY+7,64,76)}else{mainCanvas.drawImage(this.img,320,0,this.shadowWidth,this.shadowHeight,this.positionX+this.shadowOffsetX,this.positionY+this.shadowOffsetY,this.shadowWidth,this.shadowHeight);mainCanvas.drawImage(this.img,this.status*this.width,this.characterType*this.height,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}if(this.isPoisoning){mainCanvas.drawImage(this.img,6*this.width,160,this.width,this.height,this.positionX,this.positionY,this.width,this.height);mainCanvas.drawImage(this.img,320,0,this.shadowWidth,this.shadowHeight,this.positionX+this.shadowOffsetX,this.positionY+this.shadowOffsetY,this.shadowWidth,this.shadowHeight)}}else{mainCanvas.drawImage(this.img,241,80,64,78,this.positionX-36,this.positionY+2,64,78)}}else{mainCanvas.drawImage(this.img,this.status*this.width,this.characterType*this.height,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}};Enemy.prototype.update=function(){if(!this.isDead){Character.prototype.update.call(this);if(!this.isDoingAction){this.setNewAction()}if(game.isGameOver){this.isDoingAction=true;this.status=this.STATUS_STAND;if(this.jumpCount<this.JUMP_TOTAL_COUNT){this.positionY-=this.jumpDy;this.jumpDy--;this.jumpCount++}else{this.jumpCount=0;this.jumpDy=10}}}};Enemy.prototype.moveTo=function(e){var t=40;if(e.x<this.width/2){e.x=Math.floor(Math.random()*t);e.y+=Math.floor(Math.random()*t)}if(e.y<this.height){e.y=Math.floor(Math.random()*t);e.x+=Math.floor(Math.random()*t)}while(e.y>-.75*e.x+SCREEN_HEIGHT-t){var i=Math.floor(Math.random()*t+20);e.x-=i*.8;e.y-=i*.6}if(e.x<this.width/2||e.y<this.height||e.y>-.75*e.x+SCREEN_HEIGHT-t){e.x=this.positionX+this.width/2;e.y=this.positionY+this.height}Character.prototype.moveTo.call(this,e)};Enemy.prototype.getAIFunc=function(e){var t=[function(e){var t=0;if(e.isFrozen){t=e.ACTION_TYPE_STOP}else{var i=Math.random();if(i<.1){t=e.ACTION_TYPE_STOP}else if(i<.4){t=e.ACTION_TYPE_ATTACK}else{t=e.ACTION_TYPE_MOVE}}switch(t){case e.ACTION_TYPE_STOP:e.timer=setTimeout(function(){e.isDoingAction=false}.bind(e),Math.floor(Math.random()*2e3)+200);break;case e.ACTION_TYPE_ATTACK:e.timer=setTimeout(function(){e.startForce();setTimeout(function(){e.endForce(Math.random()*50+40)}.bind(e),Math.floor(Math.random()*2e3)+400)}.bind(e),Math.floor(Math.random()*400)+200);break;case e.ACTION_TYPE_MOVE:var s=Math.floor(Math.random()*10+10);var a=Math.random()*2*Math.PI;var o=e.positionX+e.width/2+s*Math.cos(a);var n=e.positionY+e.height+s*Math.sin(a);var l=0;while(o<e.width/2||n<e.height||n>-.75*o+SCREEN_HEIGHT-80){s=Math.floor(Math.random()*10+10);a=Math.random()*2*Math.PI;o=e.positionX+e.width/2+s*Math.cos(a);n=e.positionY+e.height+s*Math.sin(a);l++;if(l>10){o=n=80;break}}Character.prototype.moveTo.call(e,new Point(o,n));break}},function(e){var t=0;if(e.isFrozen){t=e.ACTION_TYPE_STOP}else{var i=Math.random();if(i<.1){t=e.ACTION_TYPE_STOP}else if(i<.5){t=e.ACTION_TYPE_ATTACK}else{t=e.ACTION_TYPE_MOVE}}switch(t){case e.ACTION_TYPE_STOP:e.timer=setTimeout(function(){e.isDoingAction=false}.bind(e),Math.floor(Math.random()*2e3)+500);break;case e.ACTION_TYPE_ATTACK:e.timer=setTimeout(function(){e.startForce();setTimeout(function(){e.endForce(Math.floor(Math.random()*60)+40)}.bind(e),Math.floor(Math.random()*2e3)+400)}.bind(e),Math.floor(Math.random()*400+200));break;case e.ACTION_TYPE_MOVE:var s=Math.floor(game.player.positionX+game.player.width/2);var a=Math.floor(game.player.positionY+game.player.height);var o=Math.floor(e.positionX+e.width/2);var n=Math.floor(e.positionY+e.height);var l=Math.floor(Math.random()*50-20);var h=0;var r=Math.floor((4*(n-a)+3*(s+o))/6+l*.8-h*.8);var p=Math.floor((4*(a+n)+3*(o-s))/8+l*.6+h*.8);if(r>0&&p<e.height){p=Math.floor(e.height+1)}if(r<e.width/2&&p>0){r=Math.floor(e.width/2+1)}if(p>-.75*r+SCREEN_HEIGHT-80){r=o;p=n}e.moveTo.call(e,new Point(r,p));break}}];return t[e]};Enemy.prototype.setNewAction=function(){if(this.isRigidity)return;this.getAIFunc(this.aiLevel)(this);this.isDoingAction=true};Enemy.prototype.die=function(e){Character.prototype.die.call(this,e);var t=++e.ckNoDamage-3;if(t>7)t=7;if(t>=0&&!e.ckNoDamageAchievement[t]){e.ckNoDamageAchievement[t]=true;switch(e.ckNoDamage){case 3:game.seKillingSpree.play();break;case 4:game.seDominating.play();break;case 5:game.seMegaKill.play();break;case 6:game.seUnstoppable.play();break;case 7:game.seWickedSick.play();break;case 8:game.seMonsterKill.play();break;case 9:game.seGodLike.play();break;default:e.ckNoDamageAchievement[7]=false;game.seHolyShit.play();break}var i=[200,300,450,650,900,1200,1600,2e3];game.addScore("ACHIEVEMENT",this.NO_DAMAGE_ACHIEVEMENT_LIST[t]);game.spriteGroup.add(new AchievementBoard(IMAGE_RESOURCE[WIDGET_IMAGE_PATH],this.NO_DAMAGE_ACHIEVEMENT_CHN_LIST[t],game.stageClass,i[t]));game.LogList.push(new Log(EVENT_ACHIEVEMENT,{stage:game.stageNum,type:this.NO_DAMAGE_ACHIEVEMENT_LIST[t]}));return}var s=++e.ckShortTime-2;if(s>3)s=3;if(s>=0&&s<=3&&!e.ckShortTimeAchievement[s]){e.ckShortTimeCount=0;e.ckShortTimeAchievement[s]=true;switch(e.ckShortTime){case 2:game.seDoubleKill.play();break;case 3:game.seTripleKill.play();break;case 4:game.seUltraKill.play();break;default:e.ckShortTimeAchievement[3]=false;game.seRampage.play();break}var i=[500,750,1e3,1250];game.addScore("ACHIEVEMENT",this.SHORT_TIME_ACHIEVEMENT_LIST[s]);game.spriteGroup.add(new AchievementBoard(IMAGE_RESOURCE[WIDGET_IMAGE_PATH],this.SHORT_TIME_ACHIEVEMENT_CHN_LIST[s],game.stageClass,i[s]));game.LogList.push(new Log(EVENT_ACHIEVEMENT,{stage:game.stageNum,type:this.SHORT_TIME_ACHIEVEMENT_LIST[s]}))}};function Snowball(e,t){DynamicSprite.call(this,e);this.width=20;this.height=20;this.positionX=t.positionX;this.positionY=t.positionY;this.drawLayer=6;this.shadowX=this.positionX-6;this.shadowY=this.positionY+53;this.shadowHeight=12;this.radius=10;this.force=t.force;this.directionToEnemy=t.directionToEnemy;this.host=t.host;this.attackType=this.host.attackType;var i=(this.host.snowballSpeedLevel-1)*this.host.SNOWBALL_SPEED_FACTOR+this.host.SNOWBALL_INIT_SPEED+this.force*.1;this.moveDx=i*.8*(this.directionToEnemy?-1:1);this.moveDy=i*.6*(this.directionToEnemy?-1:1);this.shadowMoveDx=this.moveDx;this.shadowMoveDy=this.moveDy;this.isFalling=true;this.flyCount=0;this.flyTotalCount=this.force/5*3;this.fallingCount=0;this.fallingTotalCount=3}Snowball.prototype=new DynamicSprite;Snowball.prototype.draw=function(){if(this.attackType==this.host.ATTACK_TYPE_FIRE){mainCanvas.drawImage(this.img,100,27,43,43,this.positionX,this.positionY,43,43)}else{mainCanvas.drawImage(this.img,this.attackType*this.width,0,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}mainCanvas.drawImage(this.img,0,20,this.width,this.shadowHeight,this.shadowX,this.shadowY,this.width,this.shadowHeight)};Snowball.prototype.update=function(){if(this.positionX+this.width<0||this.positionX>SCREEN_WIDTH||this.positionY+this.height<0||this.positionY>SCREEN_HEIGHT||this.isFalling&&this.fallingCount>this.fallingTotalCount){if(this.host.attackType==this.host.ATTACK_TYPE_FIRE){var e=(this.host.attackLevel-1)*this.host.ATTACK_FACTOR+this.host.INIT_ATTACK;this.explode({hitEnemy:null,hitPoint:e})}this.isToDisposed=true}else{if(this.flyCount<this.flyTotalCount){this.flyCount++}else if(!this.isFalling){this.moveDy=0;this.isFalling=true}else{this.moveDy+=3;this.fallingCount++}this.positionX+=this.moveDx;this.positionY+=this.moveDy;this.shadowX+=this.shadowMoveDx;this.shadowY+=this.shadowMoveDy;this.collisionDetect(game.player,game.enemyGroup.group)}};Snowball.prototype.explode=function(e){game.spriteGroup.add(new ExplosionEffect(IMAGE_RESOURCE[EXPLOSION_IMAGE_PATH],new Point(this.positionX,this.positionY)));var t=game.enemyGroup.group;var i=Math.floor(this.positionX+this.radius);var s=Math.floor(this.positionY+this.radius);var a=60;var o=0;var n=0;for(var l in t){var h=t[l];if(e.hitEnemy==null){o=Math.floor(h.positionX+h.width/2);n=Math.floor(h.positionY+h.height)}else if(h!=e.hitEnemy){o=Math.floor(h.positionX+e.referenceOffsetX);n=Math.floor(h.positionY+e.referenceOffsetY)}else{continue}var r=Math.sqrt((i-o)*(i-o)+(s-n)*(s-n));if(!h.isDead&&r<a){var p=Math.atan2(n-s,o-i);var v=a*5/r*Math.cos(p);var d=a*5/r*Math.sin(p);if(v>a*.7)v=a*.7;if(d>a*.7)d=a*.7;h.moveDx=Math.floor(v);h.moveDy=Math.floor(d)/2;h.isMoving=true;h.tickCount=0;h.TOTAL_COUNT=5;h.hp-=e.hitPoint/2;if(h.hp<=0){h.die(this.host)}}}game.seExplosion.play()};Snowball.prototype.collisionDetect=function(e,t){var i=function(e,t){var i=e.positionX+e.radius;var s=e.positionY+e.radius;var a=t.positionX+10;var o=t.positionY+10;var n=t.width-20;var l=t.height-20;return i>a&&i<a+n&&s>o&&s<o+l};if(this.host==e){for(var s in t){if(t[s]!=null&&!t[s].isDead&&i(this,t[s])){var a=(this.host.attackLevel-1)*this.host.ATTACK_FACTOR+this.host.INIT_ATTACK;t[s].beHit(a,this.host);if(this.host.attackType==this.host.ATTACK_TYPE_FIRE){this.explode({hitEnemy:t[s],hitPoint:a,referenceOffsetX:this.positionX+this.radius-t[s].positionX,referenceOffsetY:this.positionY+this.radius-t[s].positionY})}this.isToDisposed=true}}}else{if(!e.isDead&&!e.isInvisible&&i(this,e)){e.beHit((this.host.attackLevel-1)*this.host.ATTACK_FACTOR+this.host.INIT_ATTACK,this.host);e.ckNoDamage=0;for(var s in e.ckNoDamageAchievement){e.ckNoDamageAchievement[s]=false}this.isToDisposed=true}}};function RoleGroup(e){this.group=new Array;this.groupType=e;this.drawLayer=0;switch(this.groupType){case"Item":this.drawLayer=4;break;case"HpTrough":this.drawLayer=7;break;case"Enemy":this.drawLayer=5;break}}RoleGroup.prototype.draw=function(){for(i in this.group){if(this.group[i]!=null){this.group[i].draw()}}};RoleGroup.prototype.update=function(){for(var e in this.group){if(this.group[e]!=null){this.group[e].update()}if(this.group[e].isToDisposed){this.group.splice(e,1)}}if(this.groupType=="Enemy"){this.group.sort(function(e,t){if(e.positionY>t.positionY)return 1;else if(e.positionY==t.positionY)return 0;else return-1})}this.group.sort(function(e,t){return e.drawLayer-t.drawLayer})};RoleGroup.prototype.add=function(e){this.group.push(e)};RoleGroup.prototype.clear=function(){this.group.splice(0)};function Point(e,t){this.y=t;this.x=e}function EnemyAction(e,t){this.type=e||"stop";this.duration=t.duration||1e4;this.endPosition=t.endPosition||new Point(0,0);this.startPosition=t.startPosition||new Point(0,0);this.bulletCount=t.bulletCount||0;this.interval=t.interval;this.acceleration=t.acceleration;this.v0=t.v0||0}var StageInfo=new Array(999);StageInfo[0]=[{aiLevel:0,startPosition:new Point(70,141),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1e3},{aiLevel:0,startPosition:new Point(250,158),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1e3},{aiLevel:0,startPosition:new Point(341,34),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1e3}];StageInfo[1]=[{aiLevel:0,startPosition:new Point(290,147),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1e3},{aiLevel:0,startPosition:new Point(340,47),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1e3},{aiLevel:0,startPosition:new Point(119,174),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1250}];StageInfo[2]=[{aiLevel:0,startPosition:new Point(40,121),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:2,MAX_HP:1250},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1250},{aiLevel:0,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500}];StageInfo[3]=[{aiLevel:1,startPosition:new Point(70,141),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1250},{aiLevel:0,startPosition:new Point(250,158),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(341,44),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(241,34),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:2,MAX_HP:1500}];StageInfo[4]=[{aiLevel:1,startPosition:new Point(50,41),attackLevel:1,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(341,130),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(241,34),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:2,MAX_HP:1500}];StageInfo[5]=[{aiLevel:1,startPosition:new Point(70,141),attackLevel:1,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(141,14),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[6]=[{aiLevel:1,startPosition:new Point(170,41),attackLevel:1,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(150,158),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:1,startPosition:new Point(332,156),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1500},{aiLevel:0,startPosition:new Point(41,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[7]=[{aiLevel:0,startPosition:new Point(70,141),attackLevel:1,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:1,startPosition:new Point(50,358),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:1,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(241,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[8]=[{aiLevel:0,startPosition:new Point(241,41),attackLevel:1,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:1,startPosition:new Point(50,388),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:2,MAX_HP:1500},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1750},{aiLevel:1,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(70,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[9]=[{aiLevel:1,startPosition:new Point(70,341),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1500},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1750},{aiLevel:0,startPosition:new Point(150,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(241,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[10]=[{aiLevel:0,startPosition:new Point(70,241),attackLevel:2,moveSpeedLevel:1,snowballSpeedLevel:1,MAX_HP:1750},{aiLevel:1,startPosition:new Point(320,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:1,MAX_HP:1750},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(141,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(241,222),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[11]=[{aiLevel:1,startPosition:new Point(241,70),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(70,141),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(141,255),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750}];StageInfo[12]=[{aiLevel:1,startPosition:new Point(70,141),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(170,41),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(70,141),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(380,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(38,354),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3}];StageInfo[13]=[{aiLevel:1,startPosition:new Point(90,441),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(250,158),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(50,58),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(141,34),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(381,134),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(441,55),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3}];StageInfo[14]=[{aiLevel:1,startPosition:new Point(441,110),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:0,startPosition:new Point(141,58),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(50,26),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:1750},{aiLevel:0,startPosition:new Point(341,34),attackLevel:2,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(261,150),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(239,210),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3}];StageInfo[15]=[{aiLevel:1,startPosition:new Point(470,68),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:1750},{aiLevel:1,startPosition:new Point(170,141),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:1750},{aiLevel:0,startPosition:new Point(299,58),attackLevel:2,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(41,380),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(141,34),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(229,95),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3}];StageInfo[16]=[{aiLevel:1,startPosition:new Point(50,111),attackLevel:2,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:1750},{aiLevel:1,startPosition:new Point(256,191),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(169,288),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(341,34),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(121,384),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(241,55),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3}];StageInfo[17]=[{aiLevel:1,startPosition:new Point(90,141),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(10,241),attackLevel:2,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(250,158),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(341,34),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(141,94),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(41,430),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3}];StageInfo[18]=[{aiLevel:0,startPosition:new Point(51,421),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(90,111),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(270,291),attackLevel:2,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(250,158),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(341,214),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(141,94),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(241,15),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250}];StageInfo[19]=[{aiLevel:1,startPosition:new Point(270,91),attackLevel:2,moveSpeedLevel:2,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(350,188),attackLevel:3,moveSpeedLevel:2,snowballSpeedLevel:3,MAX_HP:2e3},{aiLevel:0,startPosition:new Point(45,134),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:2,MAX_HP:2e3},{aiLevel:1,startPosition:new Point(241,234),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(441,34),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(141,296),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:1,startPosition:new Point(191,155),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250}];StageInfo[20]=[{aiLevel:1,startPosition:new Point(70,10),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:1,startPosition:new Point(350,168),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(221,79),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(291,99),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:1,startPosition:new Point(41,134),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(441,24),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(141,296),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250}];StageInfo[21]=[{aiLevel:0,startPosition:new Point(170,11),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:1,startPosition:new Point(90,258),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2250},{aiLevel:0,startPosition:new Point(290,58),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2500},{aiLevel:0,startPosition:new Point(21,134),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2500},{aiLevel:1,startPosition:new Point(121,64),attackLevel:3,moveSpeedLevel:4,snowballSpeedLevel:3,MAX_HP:2500},{aiLevel:0,startPosition:new Point(341,164),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2500},{aiLevel:1,startPosition:new Point(241,95),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:2500}];StageInfo[22]=[{aiLevel:1,startPosition:new Point(70,11),attackLevel:3,moveSpeedLevel:4,snowballSpeedLevel:3,MAX_HP:2500},{aiLevel:0,startPosition:new Point(250,198),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2500},{aiLevel:1,startPosition:new Point(170,111),attackLevel:3,moveSpeedLevel:3,snowballSpeedLevel:4,MAX_HP:2500},{aiLevel:0,startPosition:new Point(41,334),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:3,MAX_HP:2750},{aiLevel:1,startPosition:new Point(241,134),attackLevel:3,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:2750},{aiLevel:0,startPosition:new Point(141,64),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:3,MAX_HP:2750},{aiLevel:1,startPosition:new Point(441,56),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:2750}];StageInfo[23]=[{aiLevel:1,startPosition:new Point(170,141),attackLevel:3,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:2750},{aiLevel:1,startPosition:new Point(12,21),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:4,MAX_HP:2750},{aiLevel:1,startPosition:new Point(250,198),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:3,MAX_HP:2750},{aiLevel:0,startPosition:new Point(341,234),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3e3},{aiLevel:0,startPosition:new Point(141,168),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:4,MAX_HP:3e3},{aiLevel:1,startPosition:new Point(451,24),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3e3},{aiLevel:0,startPosition:new Point(241,255),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3e3}];StageInfo[24]=[{aiLevel:1,startPosition:new Point(266,41),attackLevel:4,moveSpeedLevel:3,snowballSpeedLevel:4,MAX_HP:3e3},{aiLevel:0,startPosition:new Point(220,158),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:3,MAX_HP:3e3},{aiLevel:0,startPosition:new Point(341,34),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:3,MAX_HP:3e3},{aiLevel:1,startPosition:new Point(151,34),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3e3},{aiLevel:1,startPosition:new Point(41,365),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(96,264),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(70,141),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250}];
StageInfo[25]=[{aiLevel:0,startPosition:new Point(70,34),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(250,158),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:1,startPosition:new Point(341,34),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(141,94),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(41,64),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:1,startPosition:new Point(50,388),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(241,234),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:1,startPosition:new Point(78,123),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250}];StageInfo[26]=[{aiLevel:0,startPosition:new Point(70,11),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:1,startPosition:new Point(250,158),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(91,398),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3250},{aiLevel:0,startPosition:new Point(141,134),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3500},{aiLevel:1,startPosition:new Point(41,64),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3500},{aiLevel:0,startPosition:new Point(10,264),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:3500},{aiLevel:0,startPosition:new Point(165,164),attackLevel:4,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:3500},{aiLevel:1,startPosition:new Point(441,55),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3500}];StageInfo[27]=[{aiLevel:1,startPosition:new Point(70,141),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:3500},{aiLevel:1,startPosition:new Point(250,258),attackLevel:4,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:3500},{aiLevel:0,startPosition:new Point(91,398),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3500},{aiLevel:1,startPosition:new Point(341,34),attackLevel:4,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:3750},{aiLevel:0,startPosition:new Point(141,124),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3750},{aiLevel:0,startPosition:new Point(41,64),attackLevel:4,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:3750},{aiLevel:1,startPosition:new Point(41,164),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:3750},{aiLevel:1,startPosition:new Point(441,55),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:3750}];StageInfo[28]=[{aiLevel:1,startPosition:new Point(17,141),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:3750},{aiLevel:0,startPosition:new Point(250,158),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3750},{aiLevel:1,startPosition:new Point(91,398),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:4,MAX_HP:3750},{aiLevel:1,startPosition:new Point(341,34),attackLevel:4,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:3750},{aiLevel:0,startPosition:new Point(221,334),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(41,64),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(121,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(291,255),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4e3},{aiLevel:0,startPosition:new Point(141,94),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4e3}];StageInfo[29]=[{aiLevel:1,startPosition:new Point(70,141),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(250,158),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(341,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4e3},{aiLevel:0,startPosition:new Point(141,34),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(41,64),attackLevel:4,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4e3},{aiLevel:1,startPosition:new Point(12,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4250},{aiLevel:1,startPosition:new Point(83,194),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4250},{aiLevel:0,startPosition:new Point(144,114),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4250},{aiLevel:1,startPosition:new Point(145,94),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4250}];StageInfo[30]=[{aiLevel:1,startPosition:new Point(70,341),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:4250},{aiLevel:0,startPosition:new Point(250,158),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4250},{aiLevel:1,startPosition:new Point(341,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4250},{aiLevel:0,startPosition:new Point(141,34),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(41,64),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(212,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4250},{aiLevel:1,startPosition:new Point(83,194),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(194,114),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(445,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500}];StageInfo[31]=[{aiLevel:1,startPosition:new Point(70,341),attackLevel:5,moveSpeedLevel:4,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:0,startPosition:new Point(250,158),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4500},{aiLevel:1,startPosition:new Point(341,74),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:4,MAX_HP:4500},{aiLevel:0,startPosition:new Point(141,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(41,64),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(212,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(83,194),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(194,114),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(445,23),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500}];StageInfo[32]=[{aiLevel:1,startPosition:new Point(70,341),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:0,startPosition:new Point(288,158),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(341,54),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:0,startPosition:new Point(141,214),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(21,64),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(252,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(83,194),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(194,114),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3},{aiLevel:1,startPosition:new Point(445,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3}];StageInfo[33]=[{aiLevel:1,startPosition:new Point(70,341),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:0,startPosition:new Point(288,158),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:1,startPosition:new Point(341,54),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4500},{aiLevel:0,startPosition:new Point(141,214),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(21,64),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(252,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(83,194),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(194,114),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3},{aiLevel:1,startPosition:new Point(445,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3}];StageInfo[34]=[{aiLevel:1,startPosition:new Point(17,141),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:0,startPosition:new Point(250,158),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(91,398),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(341,34),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:0,startPosition:new Point(221,275),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:4750},{aiLevel:1,startPosition:new Point(41,64),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3},{aiLevel:1,startPosition:new Point(121,164),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3},{aiLevel:1,startPosition:new Point(291,255),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3},{aiLevel:0,startPosition:new Point(141,94),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:5e3}];StageInfo[35]=[{aiLevel:1,startPosition:new Point(68,29),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:1,startPosition:new Point(128,53),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(16,105),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:1,startPosition:new Point(68,145),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:1,startPosition:new Point(121,212),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:1,startPosition:new Point(75,262),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(16,234),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(366,23),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(294,9),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(260,85),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(300,151),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4},{aiLevel:0,startPosition:new Point(366,138),attackLevel:5,moveSpeedLevel:5,snowballSpeedLevel:5,MAX_HP:1e4}];for(var i=36;i<999;i++){StageInfo[i]=StageInfo[35]}function FallingSnow(e){Sprite.call(this,e);this.positionX=0;this.positionY=-SCREEN_HEIGHT;this.fallSpeed=Math.floor(Math.random()*3+2);this.drawLayer=4}FallingSnow.prototype=new Sprite;FallingSnow.prototype.draw=function(){mainCanvas.drawImage(this.img,this.positionX,this.positionY);mainCanvas.drawImage(this.img,this.positionX,this.positionY+SCREEN_HEIGHT)};FallingSnow.prototype.update=function(){if(this.positionY>0){this.positionY=-SCREEN_HEIGHT}else{this.positionY+=this.fallSpeed}};function HpTrough(e,t){Sprite.call(this,e);this.boardWidth=44;this.boardHeight=10;this.targetWidth=this.drawWidth=this.width=40;this.height=6;this.drawLayer=4;this.host=t;this.barOffsetX=2;this.barOffsetY=2}HpTrough.prototype=new Sprite;HpTrough.prototype.draw=function(){mainCanvas.drawImage(this.img,100,0,this.boardWidth,this.boardHeight,this.positionX,this.positionY,this.boardWidth,this.boardHeight);mainCanvas.drawImage(this.img,102,16,this.width,this.height,this.positionX+this.barOffsetX,this.positionY+this.barOffsetY,this.width,this.height);mainCanvas.drawImage(this.img,102,10,this.drawWidth,this.height,this.positionX+this.barOffsetX,this.positionY+this.barOffsetY,this.drawWidth,this.height)};HpTrough.prototype.update=function(){if(this.drawWidth!=this.targetWidth){this.drawWidth+=this.targetWidth<this.drawWidth?-1:1}if(this.drawWidth<=0&&this.host.isDead){this.isToDisposed=true}};HpTrough.prototype.setPosition=function(e){this.positionX=e.x;this.positionY=e.y-8};HpTrough.prototype.setWidthRate=function(e){this.targetWidth=Math.floor(e*this.width)};function EnergyTrough(e){DynamicSprite.call(this,e);this.width=20;this.height=80;this.drawLayer=4;this.isIncreasing=false;this.drawHeight=0;this.cutPositionY=0}EnergyTrough.prototype=new DynamicSprite;EnergyTrough.prototype.draw=function(){if(this.isIncreasing){mainCanvas.drawImage(this.img,80,this.cutPositionY,this.width,this.drawHeight,this.positionX,this.positionY+this.cutPositionY,this.width,this.drawHeight)}};EnergyTrough.prototype.update=function(){this.positionX=game.player.positionX+game.player.width+10;this.positionY=game.player.positionY;if(this.isIncreasing){if(game.player.chargeForce>=game.player.MAX_FORCE){this.cutPositionY=0;this.drawHeight=this.height}else{var e=game.player.chargeForce/game.player.MAX_FORCE*this.height;this.drawHeight=e;this.cutPositionY=this.height-e}}};function SelectedRing(e){Sprite.call(this,e);this.width=56;this.height=24;this.drawLayer=4;this.isVisible=false}SelectedRing.prototype=new Sprite;SelectedRing.prototype.draw=function(){if(this.isVisible){mainCanvas.drawImage(this.img,0,32,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}};SelectedRing.prototype.setPosition=function(e){this.positionX=e.x-7;this.positionY=e.y+68};function MoveMarker(e){Sprite.call(this,e);this.width=24;this.height=12;this.drawLayer=4;this.isVisible=false}MoveMarker.prototype=new Sprite;MoveMarker.prototype.draw=function(){if(this.isVisible){mainCanvas.drawImage(this.img,2,58,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}};MoveMarker.prototype.setPosition=function(e){this.positionX=e.x-12;this.positionY=e.y-6};function StageText(e,t){Sprite.call(this,e);this.height=this.targetHeight=67;this.width=this.targetWidth=203;this.positionX=SCREEN_WIDTH/2-this.width/2-30;this.positionY=SCREEN_HEIGHT/2-this.height/2;this.drawLayer=9;this.alpha=0;this.stageNumberList=[];t+="";for(var i=0;i<t.length;i++)this.stageNumberList.push(parseInt(t.charAt(i)));this.state=0;this.tickCount=0;this.textIndex=0;this.TEXT_INDEX_MAX=2;this.isAppearing=true;this.isTriggleClear=false;this.TOTAL_COUNT=30}StageText.prototype=new Sprite;StageText.prototype.init=function(){this.width=this.height=0;this.positionX=SCREEN_WIDTH/2;this.positionY=SCREEN_HEIGHT/2};StageText.prototype.draw=function(){if(this.state==0){mainCanvas.globalAlpha=this.alpha;for(var e in this.stageNumberList){mainCanvas.drawImage(this.img,this.stageNumberList[e]*50,0,50,80,this.positionX+this.width+30*e,this.positionY-8,50,80)}mainCanvas.drawImage(this.img,0,81,this.targetWidth,this.targetHeight,this.positionX,this.positionY,this.width,this.height);mainCanvas.globalAlpha=1}else{mainCanvas.drawImage(this.img,0,this.targetHeight*this.textIndex+148,this.targetWidth,this.targetHeight,this.positionX,this.positionY,this.width,this.height)}};StageText.prototype.update=function(){if(this.state==0){this.alpha+=.05;if(this.alpha>=1){if(this.tickCount<this.TOTAL_COUNT/3){this.tickCount++}else{this.state=1;this.init()}}}else if(this.state==1){if(this.tickCount<this.TOTAL_COUNT/3*2){var e=this.TOTAL_COUNT/3;this.positionX-=this.targetWidth/2/e;this.positionY-=this.targetHeight/2/e;this.width+=this.targetWidth/e;this.height+=this.targetHeight/e;this.tickCount++}else if(this.tickCount<this.TOTAL_COUNT){this.tickCount++}else if(this.textIndex<this.TEXT_INDEX_MAX-1){this.textIndex++;this.tickCount=this.TOTAL_COUNT/3;this.init()}else{this.state=2;this.init();this.textIndex=this.TEXT_INDEX_MAX;this.tickCount=this.TOTAL_COUNT/3;game.stageState="LOAD_ROLES"}}else if(this.state==2&&this.isTriggleClear){if(this.tickCount<this.TOTAL_COUNT/3*2){var e=this.TOTAL_COUNT/3;this.positionX-=this.targetWidth/2/e;this.positionY-=this.targetHeight/2/e;this.width+=this.targetWidth/e;this.height+=this.targetHeight/e;this.tickCount++}else if(this.tickCount<this.TOTAL_COUNT){this.tickCount++}else{game.stageState="LOAD_STAGE"}}};StageText.prototype.triggleClear=function(){this.isTriggleClear=true};function ExplosionEffect(e,t){DynamicSprite.call(this,e);this.width=64;this.height=64;this.positionX=t.x-this.width;this.positionY=t.y-this.height;this.drawLayer=8;this.sheetColumn=0;this.sheetLength=14}ExplosionEffect.prototype=new DynamicSprite;ExplosionEffect.prototype.draw=function(){mainCanvas.drawImage(this.img,this.sheetColumn*this.width,0,this.width,this.height,this.positionX,this.positionY,this.width*2,this.height*2)};ExplosionEffect.prototype.update=function(){if(this.sheetColumn<this.sheetLength){this.sheetColumn++}else{this.isToDisposed=true}};function AchievementBoard(e,t,i,s){Sprite.call(this,e);this.width=400;this.height=60;this.positionX=200;this.positionY=-this.height;this.text="获得成就："+t;this.stageClass=i;this.scoreText="+"+s;this.drawLayer=8;this.isDownMoving=true;this.waitCount=0;this.WAIT_TOTAL_COUNT=30}AchievementBoard.prototype=new Sprite;AchievementBoard.prototype.draw=function(){mainCanvas.drawImage(this.img,0,this.stageClass*this.height+80,this.width,this.height,this.positionX,this.positionY,this.width,this.height);mainCanvas.save();mainCanvas.fillStyle=FONT_FILL_STYLE[this.stageClass];mainCanvas.font="24px 幼圆";mainCanvas.fillText(this.text,this.positionX+20,this.positionY+41);mainCanvas.fillText(this.scoreText,this.positionX+380-this.scoreText.length*14,this.positionY+41);mainCanvas.restore()};AchievementBoard.prototype.update=function(){if(this.isDownMoving&&this.positionY<0){this.positionY+=2}else if(!this.isDownMoving){if(this.positionY>-50)this.positionY-=2;else this.isToDisposed=true}else if(this.waitCount<this.WAIT_TOTAL_COUNT)this.waitCount++;else this.isDownMoving=false};function Background(e,t){Sprite.call(this,e);this.positionX=this.positionY=0;this.width=SCREEN_WIDTH;this.height=t?SCREEN_HEIGHT+40:SCREEN_HEIGHT;this.drawLayer=0}Background.prototype=new Sprite;Background.prototype.draw=function(){mainCanvas.drawImage(this.img,0,0,this.width,this.height,this.positionX,this.positionY,this.width,this.height)};function StateBoard(e){Sprite.call(this,e);this.positionX=0;this.positionY=SCREEN_HEIGHT;this.width=SCREEN_WIDTH;this.height=40;this.drawLayer=7}StateBoard.prototype=new Sprite;StateBoard.prototype.draw=function(){mainCanvas.drawImage(this.img,0,SCREEN_HEIGHT,this.width,this.height,this.positionX,this.positionY,this.width,this.height)};function GameoverGround(e){Background.call(this,e);this.drawLayer=8;this.isAppearing=true;this.alpha=0}GameoverGround.prototype=new Background;GameoverGround.prototype.draw=function(){mainCanvas.save();mainCanvas.globalAlpha=this.alpha;Background.prototype.draw.call(this);mainCanvas.restore()};GameoverGround.prototype.update=function(){if(this.isAppearing){this.alpha+=.05;if(this.alpha>=1){this.isAppearing=false}}};function GameoverGroundButton(e,t){Sprite.call(this,e);this.width=151;this.height=57;this.index=t;this.positionX=this.index==0?362:531;this.positionY=436;this.drawLayer=8;this.isVisible=false;this.isMouseOn=false}GameoverGroundButton.prototype=new Background;GameoverGroundButton.prototype.draw=function(){if(this.isVisible){mainCanvas.drawImage(this.img,800,this.index==0?0:this.height,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}};function GameoverScoreBoard(e,t,i,s){Sprite.call(this,e);this.POSITIONX_LIST=[400,400,266];this.POSITIONY_LIST=[160,180,182];this.FILL_STYLE_LIST=["#632A14","6781A4","DF3941"];this.width=240;this.height=160;this.index=t;this.scoreStr=i+"";this.showText="";this.positionX=this.POSITIONX_LIST[this.index];this.positionY=this.POSITIONY_LIST[this.index];this.drawLayer=8;this.isAppearing=true;this.alpha=0;this.randomCount=0;this.RANDOM_TOTAL_COUNT=20;this.waitCount=0;this.WAIT_TOTAL_COUNT=40;this.callback=s}GameoverScoreBoard.prototype.draw=function(){mainCanvas.save();if(this.isAppearing){mainCanvas.globalAlpha=this.alpha;mainCanvas.drawImage(this.img,800,114,this.width,this.height,this.positionX,this.positionY,this.width,this.height)}else{mainCanvas.font="38px Impact";mainCanvas.fillStyle=this.FILL_STYLE_LIST[this.index];mainCanvas.drawImage(this.img,800,114,this.width,this.height,this.positionX,this.positionY,this.width,this.height);mainCanvas.fillText(this.showText,this.positionX+38,this.positionY+122)}mainCanvas.restore()};GameoverScoreBoard.prototype.update=function(){if(this.waitCount<this.WAIT_TOTAL_COUNT){this.waitCount++}else if(this.isAppearing){this.alpha+=.05;if(this.alpha>=1){this.isAppearing=false}}else if(this.randomCount<this.RANDOM_TOTAL_COUNT){this.showText="";for(var e=0;e<8;e++){this.showText+=Math.floor(Math.random()*10)+""}this.randomCount++}else{for(var e=0;e<8-this.scoreStr.length;e++){this.scoreStr="0"+this.scoreStr}this.showText=this.scoreStr;this.callback()}};function GameComponent(){}GameComponent.prototype={initialize:function(){},draw:function(){},update:function(){}};function ScreenManager(e){this.currentComponent=e}ScreenManager.prototype.draw=function(){screenManager.currentComponent.draw()};ScreenManager.prototype.update=function(){screenManager.currentComponent.update()};ScreenManager.prototype.setComponent=function(e){screenManager.currentComponent=e;screenManager.currentComponent.initialize()};ScreenManager.prototype.start=function(){screenManager.currentComponent.initialize();setInterval(screenManager.update,REFRESH_INTERVAL);setInterval(screenManager.draw,REFRESH_INTERVAL)};function Sprite(e){this.img=e;this.positionX=0;this.positionY=0;this.width=0;this.height=0;this.drawLayer=0;this.isToDisposed=false}Sprite.prototype.draw=function(){mainCanvas.drawImage(this.img,this.positionX,this.positionY)};Sprite.prototype.update=function(){};function DynamicSprite(e){Sprite.call(this,e);this.totalSwitchImageFrame=16;this.currentSwitchImageFrame=0;this.sheetRow=0;this.sheetColumn=0;this.sheetLength=1}DynamicSprite.prototype=new Sprite;DynamicSprite.prototype.draw=function(){mainCanvas.drawImage(this.img,this.sheetColumn*this.width,this.sheetRow*this.height,this.width,this.height,this.positionX,this.positionY,this.width,this.height)};DynamicSprite.prototype.update=function(){if(this.currentSwitchImageFrame<this.totalSwitchImageFrame){this.currentSwitchImageFrame++}else{this.sheetColumn=this.sheetColumn<this.sheetLength-1?this.sheetColumn+1:0;this.currentSwitchImageFrame=0}};function TriggleSprite(e,t){Sprite.call(this,e);this.tickCount=0;if(t.position!=undefined){this.positionX=t.position.x;this.positionY=t.position.y}this.width=t.width||this.width;this.height=t.height||this.height;this.TOTAL_COUNT=Math.round(t.duration/REFRESH_INTERVAL)}TriggleSprite.prototype=new Sprite;TriggleSprite.prototype.update=function(){if(this.tickCount<this.TOTAL_COUNT){this.tickCount++}else{this.isToDisposed=true}};function SpriteGroup(){this.collections=new Array}SpriteGroup.prototype.add=function(e){this.collections.push(e);this.flush();return this.collections.indexOf(e)};SpriteGroup.prototype.remove=function(e){var t=this.collections.indexOf(e);if(t>=0){this.collections.splice(t,1)}};SpriteGroup.prototype.change=function(e,t){this.collections.splice(e,1,t);this.flush()};SpriteGroup.prototype.flush=function(){this.collections.sort(function(e,t){return e.drawLayer-t.drawLayer})};SpriteGroup.prototype.draw=function(){for(index in this.collections){if(this.collections[index]!=null){this.collections[index].draw()}}};SpriteGroup.prototype.update=function(){for(index in this.collections){if(this.collections[index]!=null){this.collections[index].update()}if(this.collections[index]==null||this.collections[index].isToDisposed){this.collections.splice(index,1)}}};function Point(e,t){this.y=t;this.x=e}function AudioSprite(e,t){this.audioSprite=e;this.audioSprite.loop=t}AudioSprite.prototype.play=function(){this.audioSprite.play()};AudioSprite.prototype.pause=function(){this.audioSprite.pause()};AudioSprite.prototype.stop=function(){this.audioSprite.currentTime=0;this.audioSprite.pause()};function loadJs(e){if(!e)return;var t=document.getElementsByTagName("HEAD")[0];var i=document.createElement("script");i.type="text/javascript";i.src=e;t.appendChild(i)}function submitBoxClickOk(){if(!game.hasSubmitScore){submitScore()}}function submitBoxClickCancel(){$("#submitBox").hide()}function rankListClickBack(){$("#rankList").hide()}var userInfo;function submitScore(){game.hasSubmitScore=true;userInfo={name:$("#usernameInput").val(),score:game.gameScore};var e="/score";var t=JSON.stringify({name:$("#usernameInput").val()||"匿名",mobile:$("#contact").val(),log:game.LogList});$.ajax({type:"POST",url:e,data:t,success:function(e){$("#submitBox").hide();$("#rankList").show();alert("提交成功！");$("#rankTable").empty();$("#rankTable").append("<tr><th>排名</th><th>昵称</th><th>得分</th></tr>");var t=[];var i=e.surrounding;var s=0;for(var a in i){if(i[a].rank==e.rank){s=parseInt(a);break}}t.push(i[s]);var o=s-1;while(o>=0&&t.length<5){t.push(i[o]);o--}t.reverse();var n=s+1;while(n<i.length&&t.length<10){t.push(i[n]);n++}for(var a in t){var l=t[a].rank;var h=t[a].name;var r=t[a].score;var p;if(l==e.rank){p=$("<tr><td><font color='#3399FF'>"+l+"</td><td><font color='#3399FF'>"+h+"</td><td><font color='#3399FF'>"+r+"</td></tr>")}else{p=$("<tr><td>"+l+"</td><td>"+h+"</td><td>"+r+"</td></tr>")}$("#rankTable").append(p)}console.info(e)},error:function(e){alert("提交失败，请重新尝试！");game.hasSubmitScore=false;console.error(e)},dataType:"json",contentType:"application/json",processData:false})}function getTop10(){var e="/board";$.ajax({type:"GET",url:e,data:{},success:function(e){for(var t in e[t]){var i=parseInt(t)+1;var s=e[t].name;var a=e[t].score;var o;if(i==e[t].rank){o=$("<tr><td><font color='#3399FF'>"+i+"</td><td><font color='#3399FF'>"+s+"</td><td><font color='#3399FF'>"+a+"</td></tr>")}else{o=$("<tr><td>"+i+"</td><td>"+s+"</td><td>"+a+"</td></tr>")}$("#rankTable").append(o)}console.info(e)},error:function(e){console.error(e)},dataType:"json",contentType:"application/json",processData:false})}